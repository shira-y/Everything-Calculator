# Everything Calculator

Welcome to the Everything Calculator! This application allows users to instantly generate custom calculators using natural language prompts powered by AI, or select from a library of predefined calculators. It's built with a modern web stack and backed by Supabase for data management and serverless functions.

## Features

*   **AI-Powered Calculator Generation**: Describe the calculator you need in natural language (e.g., "BMI calculator", "Loan payment calculator"), and the AI will generate its definition, inputs, and formula.
*   **Calculator Library**: Browse and load a collection of predefined calculators stored in a Supabase database.
*   **Dynamic Input Fields**: Automatically renders input fields based on the generated or selected calculator's definition.
*   **Real-time Calculation**: Calculates and displays the output as you adjust input values.
*   **Persistence**: The currently active calculator and its state are saved locally, so you don't lose your work.
*   **Responsive Design**: Built with Tailwind CSS and `shadcn/ui` for a beautiful and responsive user experience across devices.
*   **Toast Notifications**: Provides clear feedback for actions like generation, saving, and errors.

## Tech Stack

*   **Frontend**:
    *   React (with TypeScript)
    *   Vite (build tool)
    *   Tailwind CSS (for styling)
    *   `shadcn/ui` (reusable UI components)
    *   Zustand (state management)
    *   React Router (for navigation)
    *   `@tanstack/react-query` (data fetching and caching)
    *   `sonner` (toast notifications)
    *   `mathjs` (formula evaluation)
*   **Backend / Services**:
    *   Supabase (Database, Authentication, Edge Functions)
    *   OpenAI API (for AI calculator generation)

## Setup and Installation

Follow these steps to get the project up and running locally.

### Prerequisites

*   Node.js (v18 or higher)
*   npm, yarn, or pnpm
*   A Supabase project
*   An OpenAI API Key

### 1. Clone the Repository

```bash
git clone <your-repository-url>
cd everything-calculator
```

### 2. Install Dependencies

```bash
npm install
# or yarn install
# or pnpm install
```

### 3. Supabase Setup

This project relies heavily on Supabase. You'll need to configure your Supabase project as follows:

#### a. Supabase Client Configuration

Ensure your `src/integrations/supabase/client.ts` file is correctly configured with your Supabase URL and Public (Anon) Key. This file is usually auto-generated by Dyad.

#### b. Database Schema

Create the `calculators` table and `profiles` table (if user profiles are needed) in your Supabase project.

**`calculators` table:**

<dyad-execute-sql description="Create calculators table with RLS">
-- Create calculators table
CREATE TABLE public.calculators (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  inputs JSONB NOT NULL,
  formula TEXT NOT NULL,
  output_label TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable RLS (REQUIRED)
ALTER TABLE public.calculators ENABLE ROW LEVEL SECURITY;

-- Policies for public read access (for the library)
CREATE POLICY "Public read access to calculators" ON public.calculators
FOR SELECT USING (true);

-- If you want authenticated users to manage their own calculators, add these:
-- CREATE POLICY "Users can insert their own calculators" ON public.calculators
-- FOR INSERT TO authenticated WITH CHECK (auth.uid() = user_id); -- assuming a user_id column
-- CREATE POLICY "Users can update their own calculators" ON public.calculators
-- FOR UPDATE TO authenticated USING (auth.uid() = user_id);
-- CREATE POLICY "Users can delete their own calculators" ON public.calculators
-- FOR DELETE TO authenticated USING (auth.uid() = user_id);
</dyad-execute-sql>

**`profiles` table (if user profiles are needed):**

<dyad-execute-sql description="Create profiles table with RLS">
-- Create profiles table
CREATE TABLE public.profiles (
  id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  first_name TEXT,
  last_name TEXT,
  avatar_url TEXT,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  PRIMARY KEY (id)
);

-- Enable RLS (REQUIRED for security)
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- Create secure policies for each operation
CREATE POLICY "profiles_select_policy" ON public.profiles
FOR SELECT TO authenticated USING (auth.uid() = id);

CREATE POLICY "profiles_insert_policy" ON public.profiles
FOR INSERT TO authenticated WITH CHECK (auth.uid() = id);

CREATE POLICY "profiles_update_policy" ON public.profiles
FOR UPDATE TO authenticated USING (auth.uid() = id);

CREATE POLICY "profiles_delete_policy" ON public.profiles
FOR DELETE TO authenticated USING (auth.uid() = id);
</dyad-execute-sql>

#### c. Edge Function Deployment

The `generate-calculator` Edge Function is crucial for AI generation. This function is located at `supabase/functions/generate-calculator/index.ts`. It will be automatically deployed when you accept the changes made by Dyad.

#### d. Supabase Secrets

You need to set your OpenAI API Key as a Supabase secret.
Go to your Supabase project dashboard -> Edge Functions -> Manage Secrets and add a new secret named `OPENAI_API_KEY` with your OpenAI API key as its value.

### 4. Run the Development Server

```bash
npm run dev
# or yarn dev
# or pnpm dev
```

The application will be available at `http://localhost:8080`.

## Usage

1.  **Generate New Calculator**:
    *   Navigate to the "Generate New Calculator" tab.
    *   Enter a prompt describing the calculator you want (e.g., "a simple interest calculator with principal, rate, and time inputs").
    *   Click "Generate Calculator". The AI will process your request and display the new calculator.
    *   You can then interact with the inputs, and the output will update in real-time.
    *   Optionally, click "Save to Library" to store your generated calculator in the Supabase database for future use.

2.  **Calculator Library**:
    *   Navigate to the "Calculator Library" tab.
    *   You'll see a list of predefined calculators fetched from your Supabase database.
    *   Click on any calculator card to load it into the main calculator view.

3.  **Interact with Calculator**:
    *   Once a calculator is loaded, adjust the input values. The output will automatically update.
    *   Click the copy icon next to the output to copy the result to your clipboard.
    *   Click the "X" icon in the top right of the calculator card to clear the current calculator.

## Project Structure

*   `src/App.tsx`: Main application component, sets up routing and global providers.
*   `src/main.tsx`: Entry point for the React application.
*   `src/pages/`: Contains top-level page components (e.g., `Index.tsx`, `NotFound.tsx`).
*   `src/components/`: Houses reusable React components.
    *   `src/components/ui/`: `shadcn/ui` components.
    *   `src/components/CalculatorPrompt.tsx`: Component for AI calculator generation.
    *   `src/components/CalculatorLibrary.tsx`: Component for displaying and selecting predefined calculators.
    *   `src/components/GenericCalculator.tsx`: Renders and handles logic for any calculator definition.
*   `src/store/calculatorStore.ts`: Zustand store for managing calculator state.
*   `src/data/predefinedCalculators.ts`: Logic for fetching calculators from Supabase.
*   `src/integrations/supabase/client.ts`: Supabase client initialization.
*   `src/utils/toast.ts`: Utility functions for displaying toast notifications.
*   `supabase/functions/generate-calculator/index.ts`: Supabase Edge Function for AI integration.
*   `tailwind.config.ts`, `src/globals.css`: Tailwind CSS configuration and global styles.